optimizer:
  # soap cfg
  name: "soap_precond_sf_palm"
  lr: 1.0e-3    # soap can allow a larger learning rate
  weight_decay: 1.0e-6
  # precondition_frequency: 2
  # betas: [0.95, 0.99]

  # adam cfg
  # name: adamw
  # lr: 1.0e-3
  # weight_decay: 1.0e-4
  # betas: [0.9, 0.95]
  # fused: yes
  # eps: 1.0e-8

  # psgd cfg
  # name: psgd_delayed
  # lr: 1.0e-3
  # weight_decay: 1.0e-6

lr_scheduler:
  # name: 'cos_anneal_restart_reduce'
  # T_0: 20
  # T_mult: 2
  # lr_mult: 0.7
  # eta_min: 8.0e-5
  
  # name: multi_step
  # milestones: [100, 300, 600]
  # gamma: 0.2

  name: plateau
  factor: 0.8
  patience: 10
  threshold: 1.0e-4
  threshold_mode: rel
  cooldown: 10
  min_lr: 2.0e-5

  # name: constant
  
max_norm: 0.04
ema_decay: 0.999
ema_update_every: 1

path:
  wv3_train_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/wv3/training_wv3/train_wv3.h5"
  wv3_val_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/wv3/reduced_examples/test_wv3_multiExm1.h5"
  wv3_full_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/pansharpening_test/test_wv3_OrigScale_multiExm1.h5"
  wv3_txt_train_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/wv3/training_wv3/t5_feature_wv3_train.safetensors"
  wv3_txt_val_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/wv3/reduced_examples/t5_feature_wv3_test_reduced.safetensors"
  wv3_txt_full_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/wv3/full_examples/t5_feature_wv3_test_full.safetensors"

  gf2_train_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/gf/training_gf2/train_gf2.h5"
  gf2_val_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/gf/reduced_examples/test_gf2_multiExm1.h5"
  gf2_full_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/pansharpening_test/test_gf2_OrigScale_multiExm1.h5"
  gf2_txt_train_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/gf/training_gf2/t5_feature_gf2_train.safetensors"
  gf2_txt_val_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/gf/reduced_examples/t5_feature_gf2_reduced.safetensors"
  gf2_txt_full_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/gf/full_examples/t5_feature_gf2_full.safetensors"

  qb_train_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/qb/training_qb/train_qb.h5"
  qb_val_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/qb/reduced_examples/test_qb_multiExm1.h5"
  qb_full_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/pansharpening_test/test_qb_OrigScale_multiExm1.h5"
  qb_txt_train_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/qb/training_qb/t5_feature_qb_train.safetensors"
  qb_txt_val_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/qb/reduced_examples/t5_feature_qb_reduced.safetensors"
  qb_txt_full_path: "/Data3/cao/ZiHanCao/datasets/pansharpening/qb/full_examples/t5_feature_qb_full.safetensors"

  cave_x4_train_path: "/Data3/cao/ZiHanCao/datasets/HISI/new_cave/train_cave(with_up)x4.h5"
  cave_x4_val_path: "/Data3/cao/ZiHanCao/datasets/HISI/new_cave/test_cave(with_up)x4.h5"

  cave_x8_train_path: "/Data3/cao/ZiHanCao/datasets/HISI/new_cave/x8/train_cave(with_up)x8_rgb_16.h5"
  cave_x8_val_path: "/Data3/cao/ZiHanCao/datasets/HISI/new_cave/x8/test_cave(with_up)x8_rgb.h5"

  harvard_x4_train_path: "/Data3/cao/ZiHanCao/datasets/HISI/new_harvard/train_harvard(with_up)x4_rgb.h5"
  harvard_x4_val_path: "/Data3/cao/ZiHanCao/datasets/HISI/new_harvard/test_harvard(with_up)x4_rgb.h5"

  harvard_x8_train_path: "/Data3/cao/ZiHanCao/datasets/HISI/new_harvard/x8/train_harvard(with_up)x8_rgb.h5"
  harvard_x8_val_path: "/Data3/cao/ZiHanCao/datasets/HISI/new_harvard/x8/test_harvard(with_up)x8_rgb.h5"
  
  pavia_train_path: "/Data3/cao/ZiHanCao/datasets/HISI/data_Pavia/Train_Pavia.h5"
  pavia_val_path: "/Data3/cao/ZiHanCao/datasets/HISI/data_Pavia/Test_Pavia.h5"
  pavia_txt_train_path: "/Data3/cao/ZiHanCao/datasets/HISI/data_Pavia/t5_feature_pavia_train.safetensors"
  pavia_txt_val_path: "/Data3/cao/ZiHanCao/datasets/HISI/data_Pavia/t5_feature_pavia_test.safetensors"

  chikusei_train_path: "/Data3/cao/ZiHanCao/datasets/HISI/Chikusei_x4/train_Chikusei.h5"
  chikusei_val_path: "/Data3/cao/ZiHanCao/datasets/HISI/Chikusei_x4/test_Chikusei.h5"
  chikusei_txt_train_path: "/Data3/cao/ZiHanCao/datasets/HISI/Chikusei_x4/t5_feature_chikusei_train.safetensors"
  chikusei_txt_val_path: "/Data3/cao/ZiHanCao/datasets/HISI/Chikusei_x4/t5_feature_chikusei_test.safetensors"

  msrs_base_dir: "/Data3/cao/ZiHanCao/datasets/VIF-MSRS"
  llvip_base_dir: "/Data3/cao/ZiHanCao/datasets/VIF-LLVIP/data"  # the mask is generated by using Ground-DINO-SAM project
  tno_base_dir: "/Data3/cao/ZiHanCao/datasets/VIF-TNO"
  roadscene_base_dir: "/Data3/cao/ZiHanCao/datasets/VIF-RoadSceneFusion"
  roadscene_tno_joint_base_dir: "/Data3/cao/ZiHanCao/datasets/VIF-RoadScene_and_TNO"
  m3fd_base_dir: "/Data3/cao/ZiHanCao/datasets/VIF-M3FD"
  med_harvard_base_dir: "/Data3/cao/ZiHanCao/datasets/MedHarvard"
  sice_base_dir: "/Data3/cao/ZiHanCao/datasets/MEF-SICE"
  mefb_base_dir: "/Data3/cao/ZiHanCao/datasets/MEF-MEFB"
  realmff_base_dir: "/Data3/cao/ZiHanCao/datasets/MFF-RealMFF"
  mff_whu_base_dir: "/Data3/cao/ZiHanCao/datasets/MFF-WHU/MFI-WHU"
  lytro_base_dir: "/Data3/cao/ZiHanCao/datasets/MFF-Lytro"
  vis_ir_joint_base_dir:
    # llvip: "/Data3/cao/ZiHanCao/datasets/VIF-LLVIP/data"
    # m3fd: "/Data3/cao/ZiHanCao/datasets/VIF-M3FD"
    msrs: "/Data3/cao/ZiHanCao/datasets/VIF-MSRS"
    roadscene_tno_joint: "/Data3/cao/ZiHanCao/datasets/VIF-RoadScene_and_TNO"

datasets_cfg:
  msrs:
    crop_strategy: crop_resize
    with_txt_feature: yes
    only_resize: [640, 480] #[224, 280]
    fast_eval_n_samples: 80
    reduce_label: yes
    with_mask: yes
  m3fd:
    crop_strategy: crop_resize
    with_txt_feature: yes
    only_resize: [224, 280]
    fast_eval_n_samples: 80
    reduce_label: yes
    with_mask: yes
  llvip:
    crop_strategy: crop_resize
    with_txt_feature: yes
    only_resize: [224, 280]
    fast_eval_n_samples: 80
    reduce_label: yes
    with_mask: yes
  roadscene:
    with_txt_feature: yes
  tno:
    with_txt_feature: yes
  vis_ir_joint:
    crop_strategy: crop_resize
    output_size: [224, 280]
    with_txt_feature: yes
    with_mask: yes
    fast_eval_n_samples: 80
    reduce_label: yes
    random_datasets_getitem: yes
    n_thread: 4
  med_harvard:
    task: SPECT-MRI
    with_txt_feature: yes
    with_mask: yes
    only_resize: [256, 256]
    reduce_label: yes
  sice:
    with_txt_feature: yes
    with_mask: yes
    with_txt: yes
    output_size: 256
    use_gt: no
    stop_aug_when_n_iters: 1000  # -1 means no augmentation
  mefb:
    with_txt_feature: yes
    with_mask: yes
    with_txt: yes
    output_size: 256
    only_y: no
    stop_aug_when_n_iters: 1000
  realmff:
    with_mask: yes
    with_txt: yes
    output_size: 256
    use_gt: yes
    stop_aug_when_n_iters: 2_000
  mff_whu:
    with_mask: yes
    with_txt: yes
    output_size: 256
    use_gt: yes
    stop_aug_when_n_iters: 2_000
  lytro:
    with_mask: yes
    with_txt: yes
    only_y: no

network_configs:
  panRWKV_v1:
    img_channel: 8
    condition_channel: 1
    out_channel: 8
    
    ## small config
    width: 32
    middle_blk_num: 1
    enc_blk_nums: [3,2,1]
    dec_blk_nums: [3,2,1]
    drop_path_rate: 0.2

    if_abs_pos: no # buggy: convergence is slow
    if_rope: no
    patch_merge: yes
    upscale: 4

  panRWKV_v2:
    img_channel: 1
    condition_channel: 1
    out_channel: 1
    ###wv3 8,1,8
    ###gf2 4,1,4
    ###qb  4,1,4

    ## small config
    width: 24
    middle_blk_num: 1
    enc_blk_nums: [2,1,1]
    dec_blk_nums: [2,1,1]
    chan_upscales: [2,1,1]
    drop_path_rate: 0.1
    if_abs_pos: no # buggy: convergence is slow
    if_rope: no
    patch_merge: yes
    upscale: 4

  panRWKV_v3:
    img_channel: 8
    condition_channel: 1
    out_channel: 8
    ###wv3 8,1,8
    ###gf2 4,1,4
    ###qb  4,1,4

    ## tiny config 0.2M
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [1,1]
    # dec_blk_nums: [1,1]
    # chan_upscales: [1,1]
    # drop_path_rate: 0.1
    # shift_type: q_shift
    # if_abs_pos: no # buggy: convergence is slow
    # if_rope: no
    # patch_merge: yes
    # upscale: 1
    # fusion_prior: max
    # seg_plug: no

    ## small config 4.7M
    width: 32
    middle_blk_num: 1
    enc_blk_nums: [2,1,1]
    dec_blk_nums: [2,1,1]
    chan_upscales: [2,1,1]
    drop_path_rate: 0.1
    if_abs_pos: no # buggy: convergence is slow
    if_rope: no
    patch_merge: yes
    upscale: 4

    ## base config 8.9M
    # width: 64
    # middle_blk_num: 2
    # enc_blk_nums: [6,4,4,2]
    # dec_blk_nums: [6,4,4,2]
    # chan_upscales: [2,2,2,1]
    # drop_path_rate: 0.2
    # if_abs_pos: no # buggy: convergence is slow
    # if_rope: no
    # patch_merge: yes
    # upscale: 4

  panRWKV_v4:
    img_channel: 8
    condition_channel: 1
    out_channel: 8
    
    width: 32
    middle_blk_num: 1
    enc_blk_nums: [2,1,1]
    dec_blk_nums: [2,1,1]
    chan_upscales: [2,1,1]
    drop_path_rate: 0.1
    if_abs_pos: no
    if_rope: no
    patch_merge: yes
    upscale: 4

  panRWKV_cross_v5:
    img_channel: 8
    condition_channel: 1
    out_channel: 8
    
    width: 32
    middle_blk_num: 1
    enc_blk_nums: [2,1,1]
    dec_blk_nums: [2,1,1]
    chan_upscales: [2,1,1]
    drop_path_rate: 0.0
    if_abs_pos: no # buggy: convergence is slow
    if_rope: no
    patch_merge: yes
    upscale: 4

  panRWKV_plain_v6.RWKVFusion:
    img_channel: 8
    condition_channel: 1
    out_channel: 8

    width: 32
    n_layers: 6
    blks_by_layers: [2,2,2,2,2,2]
    drop_path_rate: 0.2
    if_learnable_abs_pos: no
    patch_size: 1
    patch_merge: yes
    upscale: 4

  panRWKV_k1_v7:
    img_channel: 8
    condition_channel: 1
    out_channel: 8
    
    width: 32
    middle_blk_num: 1
    enc_blk_nums: [3,2,1]
    dec_blk_nums: [3,2,1]
    chan_upscales: [2,1,1]
    drop_path_rate: 0.1
    if_abs_pos: no
    if_rope: no
    patch_merge: yes
    upscale: 4

  panrwkv_v8_cond_norm_RWKVFusion:
  # panRWKV_v8_cond_norm:
    img_channel: 3
    condition_channel: 1
    out_channel: 3
    
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [2,1,1]
    # dec_blk_nums: [2,1,1]
    # chan_upscales: [2,1,1]
    # drop_path_rate: 0.1
    # if_abs_pos: no
    # if_rope: no
    # patch_merge: yes
    # upscale: 4

    width: 32
    middle_blk_num: 1
    enc_blk_nums: [1,1]
    dec_blk_nums: [1,1]
    chan_upscales: [1,1]
    drop_path_rate: 0.0
    if_abs_pos: no
    if_rope: no
    patch_merge: no
    upscale: 1
    fusion_prior: max
    use_mask_as_cond: yes
  
  panRWKV_v9_local_RWKVFusion:
    img_channel: 8
    condition_channel: 1
    out_channel: 8

    width: 32
    middle_blk_num: 1
    mid_window_size: 0
    enc_blk_nums: [2,1,1]
    dec_blk_nums: [2,1,1]
    window_sizes: [16, 16, 16]
    chan_upscales: [2,1,1]
    drop_path_rate: 0.1
    attn_groups: [1, 2, 2]
    ffn_groups: [1, 2, 2]
    ffn_hidden_rates: [2, 2, 1]
    if_abs_pos: no
    if_rope: no
    patch_merge: yes
    upscale: 4
    fusion_prior: max
    use_mask_as_cond: no
    
  # panRWKV_v9_local.RWKVFusion:
  #   img_channel: 8
  #   modal_channel: 1
  #   out_channel: 8
  #   llm_channel: null
  #   mask_channel: null
  #   width: 32
  #   middle_blk_num: 1
  #   enc_blk_nums: [2,1,1]
  #   dec_blk_nums: [2,1,1]
  #   mid_window_size: 0
  #   enc_window_sizes: [16, 16, 16]
  #   dec_window_sizes: [16, 16, 16]
  #   chan_upscales: [2,1,1]
  #   drop_path_rate: 0.1
  #   attn_groups: [1, 2, 2]
  #   ffn_groups: [1, 2, 2]
  #   ffn_hidden_rates: [2, 2, 1]
  #   if_abs_pos: no
  #   if_rope: no
  #   patch_merge: yes
  #   upscale: 4
  #   fusion_prior: max
    
  RWKVFusion_v10_multi_modal_RWKVFusion:
    ##################### Pansharpening #####################
    ## WV3
    img_channel: 8
    modal_channel: 1
    mask_channel: null
    llm_channel: 512
    out_channel: 8
    width: 32
    middle_blk_num: 1
    enc_blk_nums: [2,1,1]
    dec_blk_nums: [2,1,1]
    chan_upscales: [2,1,1]
    mid_window_size: 0
    enc_window_sizes: [16,16,16]
    dec_window_sizes: [16,16,16]
    attn_groups: [4,4,4] #[1,1,2]
    ffn_groups: [4,4,4] #[1,1,2]
    MIFM_img_downsample_ratios: [4,2,1]
    ffn_hidden_rates: [2,2,2]
    with_checkpoint: false
    pt_img_size: 64
    drop_path_rate: 0.15
    if_abs_pos: false
    upscale: 4
    drop_txt_ratio: 0.2
    txt_embd_drop_ratio: 0.1
    patch_merge: yes

    ## GF2
    # img_channel: 4
    # modal_channel: 1
    # mask_channel: null
    # llm_channel: null
    # out_channel: 4
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [2,1,1]
    # dec_blk_nums: [2,1,1]
    # chan_upscales: [2,1,1]
    # mid_window_size: 0
    # enc_window_sizes: [16,16,16]
    # dec_window_sizes: [16,16,16]
    # attn_groups: [4,4,4]
    # ffn_groups: [4,4,4]
    # MIFM_img_downsample_ratios: [4,2,1]
    # ffn_hidden_rates: [2,2,2]
    # pt_img_size: 64
    # drop_path_rate: 0.2
    # if_abs_pos: false
    # upscale: 4
    # drop_txt_ratio: 0.0
    # txt_embd_drop_ratio: 0.0
    # with_checkpoint: no
    # patch_merge: yes

    ##################### VIF #####################
    ## base config
    # img_channel: 3
    # modal_channel: 1
    # mask_channel: 1
    # llm_channel: 1024
    # out_channel: 3
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [1,1,1]
    # dec_blk_nums: [1,1,1]
    # chan_upscales: [2,1,1]
    # mid_window_size: 7
    # enc_window_sizes: [14,14,7]
    # dec_window_sizes: [14,14,7]
    # attn_groups: [1,1,2]
    # ffn_groups: [1,1,2]
    # MIFM_img_downsample_ratios: [4,2,1]
    # ffn_hidden_rates: [2,2,2]
    # with_checkpoint: true
    # pt_img_size: 64
    # drop_path_rate: 0.1
    # if_abs_pos: false
    # upscale: 1
    # fusion_prior: max

    ## tiny config
    # img_channel: 3
    # modal_channel: 1
    # mask_channel: 1
    # llm_channel: 1024
    # out_channel: 3
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [1, 1]
    # dec_blk_nums: [1, 1]
    # chan_upscales: [1, 1]
    # mid_window_size: 14
    # enc_window_sizes: [14, 14]
    # dec_window_sizes: [14, 14]
    # attn_groups: [1, 1]
    # ffn_groups: [1, 1]
    # ffn_hidden_rates: [2, 2]
    # MIFM_img_downsample_ratios: [4, 4]
    # pt_img_size: 64
    # drop_path_rate: 0.1
    # if_abs_pos: false
    # upscale: 1
    # with_checkpoint: true
    # fusion_prior: max

    ################## medical harvard ##################
    # img_channel: 3
    # modal_channel: 1
    # mask_channel: 2
    # llm_channel: 1024
    # out_channel: 3
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [1, 1]
    # dec_blk_nums: [1, 1]
    # chan_upscales: [1, 1]
    # mid_window_size: 16
    # enc_window_sizes: [16, 16]
    # dec_window_sizes: [16, 16]
    # attn_groups: [1, 1]
    # ffn_groups: [1, 1]
    # ffn_hidden_rates: [2, 2]
    # MIFM_img_downsample_ratios: [4, 4]
    # pt_img_size: 64
    # drop_path_rate: 0.1
    # if_abs_pos: false
    # upscale: 1
    # with_checkpoint: true
    # fusion_prior: max

  RWKVFusion_v11_RWKVFusion:
    ##################### Pansharpening #####################
    ## WV3
    img_channel: 8
    modal_channel: 1
    mask_channel: null
    llm_channel: 512
    out_channel: 8
    width: 32
    middle_blk_num: 1
    enc_blk_nums: [2,1,1]
    dec_blk_nums: [2,1,1]
    chan_upscales: [2,1,1]
    mid_window_size: 0
    enc_window_sizes: [16,16,16]
    dec_window_sizes: [16,16,16]
    attn_groups: [1,2,4] #[1,1,2]
    ffn_groups: [1,2,4] #[1,1,2]
    MIFM_img_downsample_ratios: [4,2,1]
    ffn_hidden_rates: [2,2,2]
    with_checkpoint: no
    pt_img_size: 64
    drop_path_rate: 0.2
    if_abs_pos: no
    upscale: 4
    drop_txt_ratio: 0.2
    txt_embd_drop_ratio: 0.2
    patch_merge: yes
    add_multi_modal_tokens: no
    end_proj_type: 3conv
    fusion_prior: lr
    feature_prior: no
    reconstruction_head: sr

    ## pavia and chikusei
    # img_channel: 128  # [pavia: 102, chikusei: 128, wv3: 8, gf2: 4]
    # modal_channel: 3  # [pavia: 1, chikusei: 3, wv3: 1, gf2: 1]
    # mask_channel: null
    # llm_channel: 512
    # out_channel: 128
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [1,1] # [1,1,1]
    # dec_blk_nums: [1,1] # [1,1,1]
    # chan_upscales: [1,1] # [2,1,1] for pavia
    # mid_window_size: 0
    # enc_window_sizes: [16,16]
    # dec_window_sizes: [16,16]
    # attn_groups: [2,2]
    # ffn_groups: [2,2]
    # MIFM_img_downsample_ratios: [4,2]
    # ffn_hidden_rates: [2,2]  # [2,2,2] for pavia
    # with_checkpoint: no
    # pt_img_size: 64
    # drop_path_rate: 0.2
    # if_abs_pos: no
    # upscale: 4
    # drop_txt_ratio: 0.0
    # txt_embd_drop_ratio: 0.0
    # patch_merge: yes
    # add_multi_modal_tokens: no
    # end_proj_type: 3conv
    # fusion_prior: lr
    # feature_prior: no
    # reconstruction_head: sr
    # no_out_norm: no
    # add_feat_per_layer: no
    # MIFM_ffn_type: llama

    # img_channel: 102  # [pavia: 102, chikusei: 128, wv3: 8, gf2: 4]
    # modal_channel: 1  # [pavia: 1, chikusei: 3, wv3: 1, gf2: 1]
    # mask_channel: null
    # llm_channel: 512
    # out_channel: 102
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [2,1,1] # [1,1,1]
    # dec_blk_nums: [2,1,1] # [1,1,1]
    # chan_upscales: [2,1,1] # [2,1,1] for pavia
    # mid_window_size: 0
    # enc_window_sizes: [16,16,16]
    # dec_window_sizes: [16,16,16]
    # attn_groups: [1,2,4] #[1,1,2]
    # ffn_groups: [1,2,4]
    # MIFM_img_downsample_ratios: [4,2,1]
    # ffn_hidden_rates: [2,2,2]  # [2,2,2] for pavia
    # with_checkpoint: no
    # pt_img_size: 64
    # drop_path_rate: 0.2
    # if_abs_pos: no
    # upscale: 4
    # drop_txt_ratio: 0.2
    # txt_embd_drop_ratio: 0.2
    # patch_merge: yes
    # add_multi_modal_tokens: no
    # end_proj_type: 3conv
    # fusion_prior: lr
    # feature_prior: no
    # reconstruction_head: sr
    # no_out_norm: no
    # add_feat_per_layer: no
    # MIFM_ffn_type: llama

    ######### MEF #########
    ## tiny config
    # img_channel: 1
    # modal_channel: 1
    # mask_channel: 1
    # multi_value_mask_max_classes: 20
    # llm_channel: 512
    # out_channel: 1
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [1, 1]
    # dec_blk_nums: [1, 1]
    # chan_upscales: [1, 1]
    # mid_window_size: 16
    # enc_window_sizes: [16, 16]
    # dec_window_sizes: [16, 16]
    # attn_groups: [1, 1]
    # ffn_groups: [1, 1]
    # ffn_hidden_rates: [2, 2]
    # MIFM_img_downsample_ratios: [8, 8]
    # pt_img_size: 256
    # drop_path_rate: 0.0
    # if_abs_pos: no
    # upscale: 1
    # with_checkpoint: yes
    # fusion_prior: mean
    # add_multi_modal_tokens: no
    # end_proj_type: 3conv
    # reconstruction_head: fusion

    ## tiny config
    # `feature_prior` must be false, or the convergence will be very slow
    # `scan_mode` must be K2, K0 has artifacts in corners

    # ques:
    # 1. reconstruction_head (白边的问题)
    # 2. scan_mode （白边）
    # 3. y_train or color_train （颜色问题），color train 天空的颜色有问题
    # 4. 白边问题应该是来自于align_corners

    # img_channel: 3
    # modal_channel: 3
    # mask_channel: 1
    # llm_channel: 512
    # multi_value_mask_max_classes: 20
    # out_channel: 3
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [1, 1]
    # dec_blk_nums: [1, 1]
    # chan_upscales: [1, 1]
    # mid_window_size: 16
    # enc_window_sizes: [16, 16]
    # dec_window_sizes: [16, 16]
    # attn_groups: [1, 1]
    # ffn_groups: [1, 1]
    # ffn_hidden_rates: [2, 2]
    # MIFM_img_downsample_ratios: [8, 8]
    # pt_img_size: 256
    # drop_path_rate: 0.0
    # drop_txt_ratio: 0.0
    # txt_embd_drop_ratio: 0.0
    # if_abs_pos: no
    # upscale: 1
    # with_checkpoint: yes
    # add_multi_modal_tokens: no
    # end_proj_type: 3conv
    # reconstruction_head: fusion  # [sr, fusion]
    # fusion_prior: mean
    # scan_mode: K0   # [K2] may be good
    # no_out_norm: no

    ###### MFF ########
    ## tiny config
    # img_channel: 1
    # modal_channel: 1
    # mask_channel: 1
    # multi_value_mask_max_classes: 20
    # llm_channel: 512
    # out_channel: 1
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [1, 1]
    # dec_blk_nums: [1, 1]
    # chan_upscales: [1, 1]
    # mid_window_size: 16
    # enc_window_sizes: [16, 16]
    # dec_window_sizes: [16, 16]
    # attn_groups: [1, 1]
    # ffn_groups: [1, 1]
    # ffn_hidden_rates: [2, 2]
    # MIFM_img_downsample_ratios: [8, 8]
    # pt_img_size: 256
    # drop_path_rate: 0.0
    # if_abs_pos: no
    # upscale: 1
    # with_checkpoint: yes
    # fusion_prior: mean
    # add_multi_modal_tokens: no
    # end_proj_type: 3conv
    # reconstruction_head: fusion

    ###### VIF ###########
    # 1. enlarge network to small
    # 2. reconstruction_head can be fusion
    # 3. scan_mode may change to K2

    ## tiny config
    # img_channel: 1
    # modal_channel: 1
    # mask_channel: 1
    # llm_channel: 1024
    # out_channel: 1
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [1, 1]
    # dec_blk_nums: [1, 1]
    # chan_upscales: [1, 1]
    # mid_window_size: 14
    # enc_window_sizes: [14, 14]
    # dec_window_sizes: [14, 14]
    # attn_groups: [1, 1]
    # ffn_groups: [1, 1]
    # ffn_hidden_rates: [2, 2]
    # MIFM_img_downsample_ratios: [8, 8]
    # pt_img_size: [224, 280]
    # drop_path_rate: 0.
    # drop_txt_ratio: 0.
    # txt_embd_drop_ratio: 0.
    # if_abs_pos: no
    # upscale: 1
    # with_checkpoint: yes
    # fusion_prior: max
    # add_multi_modal_tokens: no
    # end_proj_type: 3conv
    # reconstruction_head: sr
    # scan_mode: K0

    ## small config: 2.0M
    # img_channel: 1
    # modal_channel: 1
    # mask_channel: 1
    # llm_channel: 1024
    # out_channel: 1
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [1, 2, 1]
    # dec_blk_nums: [1, 2, 1]
    # chan_upscales: [2, 1, 1]
    # mid_window_size: 7
    # enc_window_sizes: [14, 14, 7]
    # dec_window_sizes: [14, 14, 7]
    # attn_groups: [1, 1, 1]
    # ffn_groups: [1, 1, 1]
    # ffn_hidden_rates: [2, 2, 2]
    # MIFM_img_downsample_ratios: [4, 4, 4]
    # pt_img_size: [224, 280]
    # drop_path_rate: 0.
    # drop_txt_ratio: 0.
    # txt_embd_drop_ratio: 0.
    # if_abs_pos: no
    # upscale: 1
    # with_checkpoint: yes
    # fusion_prior: max
    # add_multi_modal_tokens: no
    # end_proj_type: 3conv
    # reconstruction_head: fusion
    # scan_mode: K2   # [K2] may be good

    # feature_prior: yes
    # no_out_norm: no  # yes
    # add_feat_per_layer: no  # yes

    ##### Medical Harvard #####
    # img_channel: 3
    # modal_channel: 1
    # mask_channel: 2
    # llm_channel: 1024
    # out_channel: 3
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [1, 1]
    # dec_blk_nums: [1, 1]
    # chan_upscales: [1, 1]
    # mid_window_size: 16
    # enc_window_sizes: [16, 16]
    # dec_window_sizes: [16, 16]
    # attn_groups: [1, 1]
    # ffn_groups: [1, 1]
    # ffn_hidden_rates: [2, 2]
    # MIFM_img_downsample_ratios: [4, 4]
    # pt_img_size: 256
    # drop_path_rate: 0.0
    # if_abs_pos: no
    # upscale: 1
    # with_checkpoint: yes
    # fusion_prior: max
    # add_multi_modal_tokens: no
    # end_proj_type: 3conv
    # reconstruction_head: fusion
    # feature_prior: yes
    # no_out_norm: yes
    # add_feat_per_layer: yes
  
  RWKVFusion_v12_RWKVFusion:
    ##################### Pansharpening #####################
    ## WV3
    # img_channel: 8
    # modal_channel: 1
    # mask_channel: null
    # llm_channel: 512
    # out_channel: 8
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [2,1,1]
    # dec_blk_nums: [2,1,1]
    # chan_upscales: [2,1,1]
    # mid_window_size: 0
    # enc_window_sizes: [0,0,0]
    # dec_window_sizes: [0,0,0]
    # MIFM_img_downsample_ratios: [4,2,1]
    # ffn_hidden_rates: [2,2,2]
    # with_checkpoint: no
    # pt_img_size: 64
    # drop_path_rate: 0.2
    # if_abs_pos: no
    # upscale: 4
    # drop_txt_ratio: 0.0
    # txt_embd_drop_ratio: 0.0
    # add_multi_modal_tokens: no
    # end_proj_type: 3conv
    # fusion_prior: lr
    # feature_prior: no
    # reconstruction_head: sr
    # scan_mode: K2   # [K2] may be good
    # patch_merge: yes

    ## pavia and chikusei
    # img_channel: 102  # [pavia: 102, chikusei: 128, wv3: 8, gf2: 4]
    # modal_channel: 1  # [pavia: 1, chikusei: 3, wv3: 1, gf2: 1]
    # mask_channel: null
    # llm_channel: 512
    # out_channel: 102
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [2,1,1] # [1,1,1]
    # dec_blk_nums: [2,1,1] # [1,1,1]
    # chan_upscales: [2,1,1] # [2,1,1] for pavia
    # mid_window_size: 0
    # enc_window_sizes: [0,0,0]
    # dec_window_sizes: [0,0,0]
    # MIFM_img_downsample_ratios: [4,2,2]
    # ffn_hidden_rates: [2,2,2]  # [2,2,2] for pavia
    # with_checkpoint: no
    # pt_img_size: 64
    # drop_path_rate: 0.3
    # if_abs_pos: no
    # upscale: 4
    # drop_txt_ratio: 0.0
    # txt_embd_drop_ratio: 0.0
    # add_multi_modal_tokens: no
    # end_proj_type: 3conv
    # fusion_prior: lr
    # reconstruction_head: sr
    # feature_prior: no
    # scan_mode: K2
    # patch_merge: yes

    # img_channel: 128  # [pavia: 102, chikusei: 128, wv3: 8, gf2: 4]
    # modal_channel: 3  # [pavia: 1, chikusei: 3, wv3: 1, gf2: 1]
    # mask_channel: null
    # llm_channel: 512
    # out_channel: 128
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [1,1] # [1,1,1]
    # dec_blk_nums: [1,1] # [1,1,1]
    # chan_upscales: [1,1] # [2,1,1] for pavia
    # mid_window_size: 0
    # enc_window_sizes: [0,0]
    # dec_window_sizes: [0,0]
    # MIFM_img_downsample_ratios: [4,2]
    # ffn_hidden_rates: [2,2]  # [2,2,2] for pavia
    # with_checkpoint: false
    # pt_img_size: 64
    # drop_path_rate: 0.2
    # if_abs_pos: false
    # upscale: 4
    # drop_txt_ratio: 0.
    # txt_embd_drop_ratio: 0.
    # patch_merge: true
    # add_multi_modal_tokens: false
    # end_proj_type: 3conv
    # fusion_prior: lr
    # feature_prior: false
    # reconstruction_head: sr

    ######### MEF #########
    ## tiny config
    # `feature_prior` must be false, or the convergence will be very slow
    # `scan_mode` must be K2, K0 has artifacts in corners

    # ques:
    # 1. reconstruction_head (白边的问题)
    # 2. scan_mode （白边）
    # 3. y_train or color_train （颜色问题），color train 天空的颜色有问题

    # img_channel: 1
    # modal_channel: 1
    # mask_channel: 1
    # llm_channel: 512
    # multi_value_mask_max_classes: 20
    # out_channel: 1
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [2, 1]
    # dec_blk_nums: [2, 1]
    # chan_upscales: [1, 1]
    # mid_window_size: 0
    # enc_window_sizes: [0, 0]
    # dec_window_sizes: [0, 0]
    # ffn_hidden_rates: [2, 2]
    # MIFM_img_downsample_ratios: [8, 4]
    # pt_img_size: 256
    # drop_path_rate: 0.1
    # drop_txt_ratio: 0.0
    # txt_embd_drop_ratio: 0.0
    # if_abs_pos: no
    # upscale: 1
    # with_checkpoint: yes
    # add_multi_modal_tokens: no
    # end_proj_type: 3conv
    # reconstruction_head: fusion # [sr, fusion]
    # fusion_prior: none
    # layer_resi_connection: 3conv
    # scan_mode: K2   # [K2] may be good
    # shift_type: none

    ## small config
    # img_channel: 1
    # modal_channel: 1
    # mask_channel: 1
    # llm_channel: 512
    # multi_value_mask_max_classes: 20
    # out_channel: 1
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [1, 1, 1]
    # dec_blk_nums: [1, 1, 1]
    # chan_upscales: [1, 2, 1]
    # mid_window_size: 16
    # enc_window_sizes: [32, 32, 16]
    # dec_window_sizes: [32, 32, 16]
    # attn_groups: [1, 1, 1]
    # ffn_groups: [1, 1, 1]
    # ffn_hidden_rates: [2, 2, 1]
    # MIFM_img_downsample_ratios: [8, 8, 4]
    # pt_img_size: 256
    # drop_path_rate: 0.1
    # drop_txt_ratio: 0.0
    # txt_embd_drop_ratio: 0.0
    # if_abs_pos: no
    # upscale: 1
    # with_checkpoint: yes
    # add_multi_modal_tokens: no
    # end_proj_type: 3conv
    # reconstruction_head: sr  # [sr, fusion]
    # fusion_prior: grad
    # scan_mode: K0   # [K2] may be good
    # shift_type: none
    # add_feat_per_layer: yes
    
    ###### MFF ########
    ## tiny config
    # img_channel: 1
    # modal_channel: 1
    # mask_channel: 1
    # multi_value_mask_max_classes: 20
    # llm_channel: 512
    # out_channel: 1
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [1, 1]
    # dec_blk_nums: [1, 1]
    # chan_upscales: [1, 1]
    # mid_window_size: 0
    # enc_window_sizes: [0, 0]
    # dec_window_sizes: [0, 0]
    # ffn_hidden_rates: [2, 2]
    # MIFM_img_downsample_ratios: [8, 8]
    # pt_img_size: [224, 280]
    # drop_path_rate: 0.1
    # drop_txt_ratio: 0.1
    # txt_embd_drop_ratio: 0.1
    # if_abs_pos: no
    # upscale: 1
    # with_checkpoint: yes
    # fusion_prior: none
    # add_multi_modal_tokens: no
    # end_proj_type: 3conv
    # reconstruction_head: fusion
    # scan_mode: K2
    # shift_type: none


    ###### VIF ###########
    # 1. enlarge network to small
    # 2. reconstruction_head can be fusion
    # 3. scan_mode may change to K2

    ## tiny config
    img_channel: 1
    modal_channel: 1
    mask_channel: 1
    llm_channel: 1024
    out_channel: 1
    width: 32
    middle_blk_num: 1
    enc_blk_nums: [1, 1]
    dec_blk_nums: [1, 1]
    chan_upscales: [1, 1]
    mid_window_size: 0
    enc_window_sizes: [0, 0]
    dec_window_sizes: [0, 0]
    ffn_hidden_rates: [2, 2]
    MIFM_img_downsample_ratios: [8, 4]
    pt_img_size: [224, 280]
    drop_path_rate: 0.2
    drop_txt_ratio: 0.1
    txt_embd_drop_ratio: 0.1
    if_abs_pos: no
    upscale: 1
    with_checkpoint: yes
    fusion_prior: none
    add_multi_modal_tokens: no
    end_proj_type: 3conv
    reconstruction_head: fusion
    scan_mode: K2
    shift_type: none

    ## small config: 2.0M
    # img_channel: 1
    # modal_channel: 1
    # mask_channel: 1
    # llm_channel: 1024
    # out_channel: 1
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [1, 2, 1]
    # dec_blk_nums: [1, 2, 1]
    # chan_upscales: [1, 2, 1]
    # mid_window_size: 0
    # enc_window_sizes: [0,0,0]
    # dec_window_sizes: [0,0,0]
    # ffn_hidden_rates: [2, 2, 2]
    # MIFM_img_downsample_ratios: [8, 4, 2]
    # pt_img_size: [224, 280]
    # drop_path_rate: 0.2
    # drop_txt_ratio: 0.1
    # txt_embd_drop_ratio: 0.1
    # if_abs_pos: no
    # upscale: 1
    # with_checkpoint: yes
    # fusion_prior: none
    # add_multi_modal_tokens: no
    # end_proj_type: 3conv
    # reconstruction_head: fusion
    # scan_mode: K2   # [K2] may be good
    # shift_type: none

    # feature_prior: yes
    # no_out_norm: no  # yes
    # add_feat_per_layer: no  # yes

    ##### Medical Harvard #####
    # img_channel: 1
    # modal_channel: 1
    # mask_channel: 2
    # llm_channel: 1024
    # # multi_value_mask_max_classes: 5
    # out_channel: 1
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [1, 1]
    # dec_blk_nums: [1, 1]
    # chan_upscales: [1, 1]
    # mid_window_size: 0
    # enc_window_sizes: [0, 0]
    # dec_window_sizes: [0, 0]
    # ffn_hidden_rates: [2, 2]
    # MIFM_img_downsample_ratios: [4, 4]
    # pt_img_size: 256
    # drop_path_rate: 0.3
    # drop_txt_ratio: 0.1
    # txt_embd_drop_ratio: 0.1
    # if_abs_pos: no
    # upscale: 1
    # with_checkpoint: no
    # add_multi_modal_tokens: no
    # layer_resi_connection: 3conv
    # end_proj_type: 3conv
    # reconstruction_head: fusion
    # fusion_prior: none
    # scan_mode: K2
    # shift_type: none

  RWKVFusion_v13_RWKVFusion:
  ##################### Pansharpening #####################
    ## WV3
    img_channel: 8
    modal_channel: 1
    mask_channel: null
    llm_channel: 512
    out_channel: 8
    width: 32
    middle_blk_num: 1
    enc_blk_nums: [2,1,1]
    dec_blk_nums: [2,1,1]
    chan_upscales: [2,1,1]
    mid_window_size: 0
    enc_window_sizes: [0,0,0]
    dec_window_sizes: [0,0,0]
    MIFM_img_downsample_ratios: [4,2,1]
    ffn_hidden_rates: [2,2,2]
    with_checkpoint: no
    pt_img_size: 64
    drop_path_rate: 0.2
    if_abs_pos: no
    upscale: 4
    drop_txt_ratio: 0.2
    txt_embd_drop_ratio: 0.2
    add_multi_modal_tokens: no
    end_proj_type: 3conv
    fusion_prior: lr
    feature_prior: no
    reconstruction_head: sr
    patch_merge: yes    
    layer_resi_connection: 3conv


  ########################## MEF ##########################
    # img_channel: 1
    # modal_channel: 1
    # mask_channel: 1
    # llm_channel: 512
    # multi_value_mask_max_classes: 20
    # out_channel: 1
    # width: 32
    # middle_blk_num: 1
    # enc_blk_nums: [1, 1]
    # dec_blk_nums: [1, 1]
    # chan_upscales: [1, 1]
    # mid_window_size: 0
    # enc_window_sizes: [0,0]
    # dec_window_sizes: [0,0]
    # ffn_hidden_rates: [2, 2]
    # MIFM_img_downsample_ratios: [8, 8]
    # pt_img_size: 256
    # drop_path_rate: 0.2
    # drop_txt_ratio: 0.0
    # txt_embd_drop_ratio: 0.0
    # if_abs_pos: no
    # upscale: 1
    # with_checkpoint: yes
    # add_multi_modal_tokens: no
    # end_proj_type: 3conv
    # reconstruction_head: fusion  # [sr, fusion]
    # fusion_prior: mean
    # scan_mode: K2   # [K2] may be good
    # shift_type: none
    # layer_resi_connection: 1conv

loss_cfg:
  drmffusion:
    latent_weighted: no
    grad_loss: yes
    color_loss: no                      # VIF: yes, others: no
    ssim_loss: yes
    prior: null
    boundary_loss: yes
    mask_loss: no                       # VIF: yes, others: no
    lpips_loss: no
    color_loss_bg_masked: yes
    tv_loss: no
    pseudo_l1_const: 0.                 # [0.002, 0.]
    correlation_loss: no
    reduce_label: no                    # VIF: no
    grad_only_on_Y: no
    grad_op: 'sobel_add'
    still_boundary_loss_when_gt: yes
    grad_norm: no
    ssim_implm_by: torch
    ssim_window_size: 5
    weight_dict:
      fusion_gt: 5.

      inten_f_joint: 10.  # prior used
      inten_f_ir: 10.
      inten_f_vi: 10.

      color_f_cb: 2.
      color_f_cr: 2.

      grad_f_joint: 20.  # [5, 40] for VIF and MEF
      ssim_f_joint: 2.

      lpips_f_gt: 1.
      
      tv_f: 0.1
      crr_f: 0.02

      # unused
      lpips_f_joint: 0.2
      lpips_f_ir: 0.2
      lpips_f_vi: 0.2

  filmfusion:
    prior: mean
    weight_grad: 1000
    weight_ssim: 1.
    ssim_window_size: 5

  l1ssim:
    weighted_r: [1.0, 0.1]
    implem_by: torch
    window_size: 5
    grad_norm: no

metric_name_for_save:
  fusion: val_loss        # for VIF, MFF, MEF tasks
    # EN: 1.28
    # SD: 0.20
    
    # SF: 0.79
    # AG: 2.36
    # MI: 2.25
    # SCD: 5.91
    # VIF: 10.2
    # Qabf: 14.3
    # SSIM: 6.2
  sharpening: PSNR  # [Pansharpening: SAM, HMIF: PSNR]
  
  check_order:
    fusion: down
    sharpening: up

logger_config:
  base_path: ./log_file/
  name: panRWKV
  file_mode: w